#!/usr/bin/env node

/**
 * –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ö–ê–†–î–ò–ù–ê–õ–¨–ù–û –£–õ–£–ß–®–ï–ù–ù–û–ô –°–ò–°–¢–ï–ú–´ –ì–ï–ù–ï–†–ê–¶–ò–ò –ë–õ–û–ì–ê
 * –ü—Ä–æ–≤–µ—Ä–∫–∞: —Å–æ–∑–¥–∞–µ—Ç –ª–∏ —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ç—å–∏ 3,500+ —Å–ª–æ–≤ —Å –ø–æ–ª–Ω–æ–π SEO-–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
 */

import { BlogGeneratorService } from './server/blog-generator.js';

// –ú–æ–∫ –¥–ª—è storage - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
const mockStorage = {
  async getBlogGenerationSettings() {
    return {
      isEnabled: true,
      frequency: "daily",
      maxArticlesPerDay: 3,
      topics: [
        "–ö–∞–∫ –æ—Ç–æ–∑–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö: –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, –û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏, Telegram",
        "–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ—Ç–∑—ã–≤–∞ —Å–æ–≥–ª–∞—Å–∏—è –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞—Ö: Wildberries, Ozon, –Ø–Ω–¥–µ–∫—Å.–ú–∞—Ä–∫–µ—Ç",
        "–ü—Ä–∞–≤–∞ —Å—É–±—ä–µ–∫—Ç–æ–≤ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —Å–æ–≥–ª–∞—Å–Ω–æ 152-–§–ó"
      ],
      contentLength: "medium",
      targetAudience: "–≥—Ä–∞–∂–¥–∞–Ω–µ –†–æ—Å—Å–∏–∏, –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ—Å—è –∑–∞—â–∏—Ç–æ–π —Å–≤–æ–∏—Ö –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö",
      seoOptimized: true,
      includeStats: true
    };
  },
  
  async createBlogGenerationSettings(settings) {
    return settings;
  }
};

async function testBlogGeneration() {
  console.log('üöÄ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ö–ê–†–î–ò–ù–ê–õ–¨–ù–û –£–õ–£–ß–®–ï–ù–ù–û–ô –°–ò–°–¢–ï–ú–´ –ì–ï–ù–ï–†–ê–¶–ò–ò –ë–õ–û–ì–ê');
  console.log('=' * 80);
  
  try {
    const blogGenerator = new BlogGeneratorService(mockStorage);
    
    console.log('üìù –¢–µ—Å—Ç–æ–≤–∞—è —Ç–µ–º–∞: "–ö–∞–∫ –æ—Ç–æ–∑–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö"');
    console.log('‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é —Å—Ç–∞—Ç—å—é —Å –Ω–æ–≤—ã–º–∏ —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏...\n');
    
    const startTime = Date.now();
    
    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Ç–∞—Ç—å—é —Å –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–Ω—ã–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏
    const article = await blogGenerator.generateBlogArticle(
      "–ö–∞–∫ –æ—Ç–æ–∑–≤–∞—Ç—å —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ—Ü–∏–∞–ª—å–Ω—ã—Ö —Å–µ—Ç—è—Ö: –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, –û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–∏, Telegram",
      "–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–≤–µ—Ç—ã"
    );
    
    const endTime = Date.now();
    const generationTime = (endTime - startTime) / 1000;
    
    console.log('‚úÖ –ì–ï–ù–ï–†–ê–¶–ò–Ø –ó–ê–í–ï–†–®–ï–ù–ê!');
    console.log(`‚è±Ô∏è –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${generationTime} —Å–µ–∫\n`);
    
    // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê –°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø –¢–†–ï–ë–û–í–ê–ù–ò–Ø–ú
    console.log('üîç –ê–ù–ê–õ–ò–ó –°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø –¢–†–ï–ë–û–í–ê–ù–ò–Ø–ú:');
    console.log('=' * 50);
    
    // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–ª–æ–≤
    const wordCount = article.content.split(/\s+/).filter(word => word.length > 0).length;
    console.log(`üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–ª–æ–≤: ${wordCount} (—Ç—Ä–µ–±—É–µ—Ç—Å—è: 3,500+)`);
    
    if (wordCount >= 3500) {
      console.log('‚úÖ –ö–†–ò–¢–ï–†–ò–ô –í–´–ü–û–õ–ù–ï–ù: –°—Ç–∞—Ç—å—è —Å–æ–¥–µ—Ä–∂–∏—Ç 3,500+ —Å–ª–æ–≤');
    } else {
      console.log(`‚ùå –ö–†–ò–¢–ï–†–ò–ô –ù–ï –í–´–ü–û–õ–ù–ï–ù: –ù–µ—Ö–≤–∞—Ç–∫–∞ ${3500 - wordCount} —Å–ª–æ–≤`);
    }
    
    // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ HTML –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
    const htmlComments = (article.content.match(/<!-- SEO:/g) || []).length;
    console.log(`ü§ñ HTML –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏: ${htmlComments} (—Ç—Ä–µ–±—É–µ—Ç—Å—è: 1+)`);
    
    if (htmlComments >= 1) {
      console.log('‚úÖ –ö–†–ò–¢–ï–†–ò–ô –í–´–ü–û–õ–ù–ï–ù: HTML –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç');
    } else {
      console.log('‚ùå –ö–†–ò–¢–ï–†–ò–ô –ù–ï –í–´–ü–û–õ–ù–ï–ù: –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç HTML –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏');
    }
    
    // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    const h2Count = (article.content.match(/## /g) || []).length;
    const h3Count = (article.content.match(/### /g) || []).length;
    const totalHeadings = h2Count + h3Count;
    console.log(`üìã –ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–∏: ${totalHeadings} (H2: ${h2Count}, H3: ${h3Count}) (—Ç—Ä–µ–±—É–µ—Ç—Å—è: 20+)`);
    
    if (totalHeadings >= 20) {
      console.log('‚úÖ –ö–†–ò–¢–ï–†–ò–ô –í–´–ü–û–õ–ù–ï–ù: –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤');
    } else {
      console.log(`‚ùå –ö–†–ò–¢–ï–†–ò–ô –ù–ï –í–´–ü–û–õ–ù–ï–ù: –ù–µ—Ö–≤–∞—Ç–∫–∞ ${20 - totalHeadings} –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤`);
    }
    
    // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ FAQ —Å–µ–∫—Ü–∏–∏
    const faqQuestions = (article.content.match(/‚ùì|FAQ|—á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã/gi) || []).length;
    console.log(`‚ùì FAQ —ç–ª–µ–º–µ–Ω—Ç—ã: ${faqQuestions} (—Ç—Ä–µ–±—É–µ—Ç—Å—è: 10+)`);
    
    if (faqQuestions >= 10) {
      console.log('‚úÖ –ö–†–ò–¢–ï–†–ò–ô –í–´–ü–û–õ–ù–ï–ù: FAQ —Å–µ–∫—Ü–∏—è –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–∞');
    } else {
      console.log(`‚ùå –ö–†–ò–¢–ï–†–ò–ô –ù–ï –í–´–ü–û–õ–ù–ï–ù: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ FAQ —ç–ª–µ–º–µ–Ω—Ç–æ–≤`);
    }
    
    // 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Å—ã–ª–æ–∫
    const internalLinks = (article.content.match(/\[.*?\]\(\/blog\/.*?\)/g) || []).length;
    console.log(`üîó –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Å—ã–ª–∫–∏: ${internalLinks} (—Ç—Ä–µ–±—É–µ—Ç—Å—è: 5+)`);
    
    if (internalLinks >= 5) {
      console.log('‚úÖ –ö–†–ò–¢–ï–†–ò–ô –í–´–ü–û–õ–ù–ï–ù: –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Å—ã–ª–∫–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç');
    } else {
      console.log(`‚ùå –ö–†–ò–¢–ï–†–ò–ô –ù–ï –í–´–ü–û–õ–ù–ï–ù: –ù–µ—Ö–≤–∞—Ç–∫–∞ ${5 - internalLinks} —Å—Å—ã–ª–æ–∫`);
    }
    
    // 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∞–±–ª–∏—Ü
    const tables = (article.content.match(/\|.*\|/g) || []).length;
    console.log(`üìä –°—Ç—Ä–æ–∫–∏ —Ç–∞–±–ª–∏—Ü: ${tables} (—Ç—Ä–µ–±—É–µ—Ç—Å—è: 3+)`);
    
    if (tables >= 3) {
      console.log('‚úÖ –ö–†–ò–¢–ï–†–ò–ô –í–´–ü–û–õ–ù–ï–ù: –¢–∞–±–ª–∏—Ü—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç');
    } else {
      console.log(`‚ùå –ö–†–ò–¢–ï–†–ò–ô –ù–ï –í–´–ü–û–õ–ù–ï–ù: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö`);
    }
    
    // –û–ë–©–ê–Ø –û–¶–ï–ù–ö–ê
    console.log('\n' + '=' * 50);
    console.log('üìà –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê –ö–ê–ß–ï–°–¢–í–ê:');
    
    const criteria = [
      wordCount >= 3500,
      htmlComments >= 1,
      totalHeadings >= 20,
      faqQuestions >= 10,
      internalLinks >= 5,
      tables >= 3
    ];
    
    const passedCriteria = criteria.filter(Boolean).length;
    const totalCriteria = criteria.length;
    const qualityScore = Math.round((passedCriteria / totalCriteria) * 100);
    
    console.log(`üèÜ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º: ${passedCriteria}/${totalCriteria} (${qualityScore}%)`);
    
    if (qualityScore >= 90) {
      console.log('üéâ –û–¢–õ–ò–ß–ù–û! –°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç —Å—Ç–∞—Ç—å–∏ –≤—ã—Å–æ—á–∞–π—à–µ–≥–æ –∫–∞—á–µ—Å—Ç–≤–∞!');
    } else if (qualityScore >= 70) {
      console.log('‚úÖ –•–û–†–û–®–û! –°–∏—Å—Ç–µ–º–∞ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–µ–Ω–∞, –Ω–æ –µ—Å—Ç—å –º–µ—Å—Ç–æ –¥–ª—è –¥–æ—Ä–∞–±–æ—Ç–∫–∏');
    } else {
      console.log('‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –î–û–†–ê–ë–û–¢–ö–ê! –°–∏—Å—Ç–µ–º–∞ –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º');
    }
    
    // –ü–û–ö–ê–ó–ê–¢–¨ –û–ë–†–ê–ó–ï–¶ –ö–û–ù–¢–ï–ù–¢–ê
    console.log('\nüìÑ –û–ë–†–ê–ó–ï–¶ –°–ì–ï–ù–ï–†–ò–†–û–í–ê–ù–ù–û–ì–û –ö–û–ù–¢–ï–ù–¢–ê:');
    console.log('=' * 50);
    console.log(`–ó–∞–≥–æ–ª–æ–≤–æ–∫: ${article.title}`);
    console.log(`–ö–∞—Ç–µ–≥–æ—Ä–∏—è: ${article.category}`);
    console.log(`–¢–µ–≥–∏: ${article.tags.join(', ')}`);
    console.log(`–í—Ä–µ–º—è —á—Ç–µ–Ω–∏—è: ${article.readingTime} –º–∏–Ω`);
    console.log(`Meta –æ–ø–∏—Å–∞–Ω–∏–µ: ${article.metaDescription}`);
    console.log('\n–ü–µ—Ä–≤—ã–µ 500 —Å–∏–º–≤–æ–ª–æ–≤ –∫–æ–Ω—Ç–µ–Ω—Ç–∞:');
    console.log('-'.repeat(50));
    console.log(article.content.substring(0, 500) + '...');
    
  } catch (error) {
    console.error('‚ùå –û–®–ò–ë–ö–ê –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø:', error.message);
    console.error('–î–µ—Ç–∞–ª–∏:', error);
  }
}

// –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
testBlogGeneration();