#!/usr/bin/env node

/**
 * UNIT TESTING –¥–ª—è Blog Generation —Å–∏—Å—Ç–µ–º—ã ResCrub
 * –¢–µ—Å—Ç–∏—Ä—É–µ—Ç —Å—Ö–µ–º—ã Zod, –≤–∞–ª–∏–¥–∞—Ü–∏—é, slug generation, retry/backoff
 */

import { z } from 'zod';

// =====================================================
// –¢–ï–°–¢ 1: OpenAIResponseSchema –≤–∞–ª–∏–¥–∞—Ü–∏—è
// =====================================================

console.log('üß™ UNIT TEST 1: OpenAIResponseSchema –≤–∞–ª–∏–¥–∞—Ü–∏—è');

// –¢–æ—á–Ω–∞—è –∫–æ–ø–∏—è —Å—Ö–µ–º—ã –∏–∑ blog-generator.ts
const OpenAIResponseSchema = z.object({
  title: z.string().min(30).max(100),
  content: z.string().min(500).refine((content) => {
    const wordCount = content.split(/\s+/).filter(word => word.length > 0).length;
    return wordCount >= 1500;
  }, {
    message: "–ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 1,500 —Å–ª–æ–≤"
  }).refine((content) => {
    return content.includes('<!-- SEO:');
  }, {
    message: "–ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å SEO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö –±–æ—Ç–æ–≤"
  }).refine((content) => {
    const h2Count = (content.match(/^## /gm) || []).length;
    const h3Count = (content.match(/^### /gm) || []).length;
    const totalHeaders = h2Count + h3Count;
    return totalHeaders >= 8 && totalHeaders <= 20;
  }, {
    message: "–ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å 8-20 –ø–æ–¥–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ H2/H3"
  }).refine((content) => {
    const faqSection = content.toLowerCase();
    const hasMainFaqSection = faqSection.includes('faq') || faqSection.includes('—á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã');
    if (!hasMainFaqSection) return false;
    
    const faqQuestions = content.match(/^### ‚ùì.*\?\s*$/gm) || [];
    return faqQuestions.length >= 5;
  }, {
    message: "FAQ —Å–µ–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 5 –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç–µ ### ‚ùì"
  }).refine((content) => {
    const internalLinks = content.match(/\[.*?\]\(\/blog\/.*?\)/g) || [];
    return internalLinks.length >= 3;
  }, {
    message: "–ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 3 –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö —Å—Å—ã–ª–∫–∏ –Ω–∞ /blog/"
  }).refine((content) => {
    return content.toLowerCase().includes('faq') || content.toLowerCase().includes('—á–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã');
  }, {
    message: "–ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å FAQ —Å–µ–∫—Ü–∏—é"
  }),
  excerpt: z.string().min(100).max(250),
  tags: z.array(z.string()).min(4).max(10),
  metaDescription: z.string().min(80).max(170),
  seoTitle: z.string().min(30).max(70).optional(),
  relatedTopics: z.array(z.string()).min(3).max(8).optional()
});

// –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –•–û–†–û–®–ò–ï (–¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏)
const validArticle = {
  title: "–ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ –∑–∞ 15 –º–∏–Ω—É—Ç: –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è 2025",
  content: `# –ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ –∑–∞ 15 –º–∏–Ω—É—Ç

<!-- SEO: –≠–∫—Å–ø–µ—Ä—Ç–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É–¥–∞–ª–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö –∏–∑ –í–ö –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π -->

–í–ö–æ–Ω—Ç–∞–∫—Ç–µ —Ö—Ä–∞–Ω–∏—Ç –æ–≥—Ä–æ–º–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∞—à–∏—Ö –ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö ‚Äî –∏ –ù–ï –≤ –≤–∞—à–∏—Ö –∏–Ω—Ç–µ—Ä–µ—Å–∞—Ö.

## –ë—ã—Å—Ç—Ä–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

**‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è:** 15 –º–∏–Ω—É—Ç

### –≠–∫—Å–ø—Ä–µ—Å—Å-–ø–ª–∞–Ω —É–¥–∞–ª–µ–Ω–∏—è:
1. **üì¶ –°–æ–∑–¥–∞–Ω–∏–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏** - –°–∫–∞—á–∞–π—Ç–µ –∞—Ä—Ö–∏–≤ –¥–∞–Ω–Ω—ã—Ö (2 –º–∏–Ω)
2. **üßπ –û—á–∏—Å—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏** - –£–¥–∞–ª–∏—Ç–µ –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç–µ –ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (3 –º–∏–Ω)

## –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –®–∞–≥ 1: –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é

**–í–∞–∂–Ω–æ!** –°–Ω–∞—á–∞–ª–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤–∞–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –Ω–∞—Å—Ç—Ä–æ–µ–∫ –í–ö: **vk.com/settings**
2. –ù–∞–π–¥–∏—Ç–µ —Ä–∞–∑–¥–µ–ª **"–û–±—â–µ–µ"**

## –û—á–∏—Å—Ç–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

1. –ó–∞–π–¥–∏—Ç–µ –≤ **"–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"** –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ –ø—Ä–æ—Ñ–∏–ª—è
2. –£–¥–∞–ª–∏—Ç–µ –∏–ª–∏ –∑–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ:
   - –§–ò–û
   - –î–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è

### –£–¥–∞–ª–∏—Ç–µ –≤–µ—Å—å –∫–æ–Ω—Ç–µ–Ω—Ç

**–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –∏ –≤–∏–¥–µ–æ:**
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª **"–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏"**
2. –í—ã–±–µ—Ä–∏—Ç–µ **"–ú–æ–∏ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏"**

## –û—Ç–∫–ª—é—á–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí **"–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è"**
2. –û—Ç–∑–æ–≤–∏—Ç–µ –¥–æ—Å—Ç—É–ø —É –≤—Å–µ—Ö —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### –û—á–∏—Å—Ç–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **"–°–æ–æ–±—â–µ–Ω–∏—è"**
2. –£–¥–∞–ª–∏—Ç–µ –≤–∞–∂–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏ –≤—Ä—É—á–Ω—É—é

## –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å

1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí **"–ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å"**
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –ò–Ω–∏—Ü–∏–∏—Ä—É–π—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ

1. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí **"–û–±—â–µ–µ"**
2. –ù–∞–π–¥–∏—Ç–µ **"–£–¥–∞–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É"**

## –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã

### –ú–µ—Ç–æ–¥ 1: –ß–µ—Ä–µ–∑ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –í–ö

–ï—Å–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.

### –ú–µ—Ç–æ–¥ 2: –ñ–∞–ª–æ–±–∞ –≤ –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä

–ü—Ä–∏ –æ—Ç–∫–∞–∑–µ –í–ö —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ.

## –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã

### –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è:

- **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ**: –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π –¥–ª—è –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **30 –¥–Ω–µ–π**: –ü–µ—Ä–∏–æ–¥ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è

## –°–≤—è–∑–∞–Ω–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

- [–ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –û–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–æ–≤ –∑–∞ 10 –º–∏–Ω—É—Ç](/blog/ok-deletion-guide)
- [–£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ Telegram: –ø–æ–ª–Ω–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å](/blog/telegram-privacy-guide)
- [–†–µ–π—Ç–∏–Ω–≥ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö —Å–æ—Ü—Å–µ—Ç–µ–π 2025](/blog/social-media-privacy-ranking)

## –ß–∞—Å—Ç–æ –∑–∞–¥–∞–≤–∞–µ–º—ã–µ –≤–æ–ø—Ä–æ—Å—ã

### ‚ùì –°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–π–º–µ—Ç –ø–æ–ª–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –í–ö?

–û—Ç 30 –¥–Ω–µ–π –¥–æ 3 –ª–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π 152-–§–ó.

### ‚ùì –ú–æ–∂–Ω–æ –ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è?

–í —Ç–µ—á–µ–Ω–∏–µ 30 –¥–Ω–µ–π –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å.

### ‚ùì –ß—Ç–æ –¥–µ–ª–∞—Ç—å –µ—Å–ª–∏ –í–ö –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –∑–∞–ø—Ä–æ—Å –æ–± —É–¥–∞–ª–µ–Ω–∏–∏?

–ü–æ–¥–∞–≤–∞–π—Ç–µ –∂–∞–ª–æ–±—É –≤ –†–æ—Å–∫–æ–º–Ω–∞–¥–∑–æ—Ä —Å–æ–≥–ª–∞—Å–Ω–æ —Å—Ç–∞—Ç—å–µ 21 152-–§–ó.

### ‚ùì –£–¥–∞–ª—è—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏—è —É –¥—Ä—É–≥–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π?

–ù–µ—Ç, —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ —á—É–∂–∏—Ö –¥–∏–∞–ª–æ–≥–∞—Ö –¥–∞–∂–µ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞.

### ‚ùì –ö–∞–∫ –∑–∞—â–∏—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–æ –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è?

–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ –≤—Å–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è —Ç—Ä–µ—Ç—å–∏—Ö –ª–∏—Ü.

### ‚ùì –í–ª–∏—è–µ—Ç –ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞ –Ω–∞ –¥–∞–Ω–Ω—ã–µ –≤ VK Pay?

VK Pay - –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –¥–∞–Ω–Ω—ã–µ –Ω—É–∂–Ω–æ —É–¥–∞–ª—è—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ —Å–ª—É–∂–±—É –ø–æ–¥–¥–µ—Ä–∂–∫–∏.

---
*–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –≤ —è–Ω–≤–∞—Ä–µ 2025 –≥–æ–¥–∞ —Å —É—á–µ—Ç–æ–º –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –í–ö –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π 152-–§–ó.*`.repeat(2), // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è 1500+ —Å–ª–æ–≤
  excerpt: "–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É–¥–∞–ª–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö –∏–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ —Å —É—á–µ—Ç–æ–º 152-–§–ó. –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Å–∫—Ä–∏–Ω—à–æ—Ç—ã, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã. –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏: –æ—Ç 3 —á–∞—Å–æ–≤ –¥–æ 15 –º–∏–Ω—É—Ç.",
  tags: ['–í–ö–æ–Ω—Ç–∞–∫—Ç–µ', '—É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö', '152-–§–ó', '–ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å', '—Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏'],
  metaDescription: "–£–∑–Ω–∞–π—Ç–µ –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ —Å–æ–≥–ª–∞—Å–Ω–æ 152-–§–ó. –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ —Å–æ–≤–µ—Ç–∞–º–∏.",
  seoTitle: "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –í–ö: –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è 2025",
  relatedTopics: ['–∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö', '—Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏', '–ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å', 'GDPR', '152-–§–ó']
};

// –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ü–õ–û–•–ò–ï (–¥–æ–ª–∂–Ω—ã –ù–ï –ø—Ä–æ–π—Ç–∏)
const invalidArticle = {
  title: "–ö–æ—Ä–æ—Ç–∫–∏–π –∑–∞–≥–æ–ª–æ–≤–æ–∫", // –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π
  content: "–ö–æ—Ä–æ—Ç–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –±–µ–∑ FAQ", // –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π, –Ω–µ—Ç FAQ, –Ω–µ—Ç SEO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
  excerpt: "–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ", // –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ
  tags: ['–æ–¥–∏–Ω'], // –°–ª–∏—à–∫–æ–º –º–∞–ª–æ —Ç–µ–≥–æ–≤
  metaDescription: "–ö–æ—Ä–æ—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ", // –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ
};

// –í—ã–ø–æ–ª–Ω—è–µ–º —Ç–µ—Å—Ç—ã
console.log('‚úÖ –¢–µ—Å—Ç–∏—Ä—É–µ–º –≤–∞–ª–∏–¥–Ω—É—é —Å—Ç–∞—Ç—å—é...');
try {
  const result = OpenAIResponseSchema.parse(validArticle);
  console.log('‚úÖ PASS: –í–∞–ª–∏–¥–Ω–∞—è —Å—Ç–∞—Ç—å—è –ø—Ä–æ—à–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫—É');
} catch (error) {
  console.log('‚ùå FAIL: –í–∞–ª–∏–¥–Ω–∞—è —Å—Ç–∞—Ç—å—è –ù–ï –ø—Ä–æ—à–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫—É');
  console.error(error.issues);
}

console.log('\nüîç –¢–µ—Å—Ç–∏—Ä—É–µ–º –Ω–µ–≤–∞–ª–∏–¥–Ω—É—é —Å—Ç–∞—Ç—å—é...');
try {
  const result = OpenAIResponseSchema.parse(invalidArticle);
  console.log('‚ùå FAIL: –ù–µ–≤–∞–ª–∏–¥–Ω–∞—è —Å—Ç–∞—Ç—å—è –ù–ï –¥–æ–ª–∂–Ω–∞ –±—ã–ª–∞ –ø—Ä–æ–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É');
} catch (error) {
  console.log('‚úÖ PASS: –ù–µ–≤–∞–ª–∏–¥–Ω–∞—è —Å—Ç–∞—Ç—å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞');
  console.log(`üìù –û—à–∏–±–∫–∏: ${error.issues.length}`);
}

// =====================================================
// –¢–ï–°–¢ 2: ArticleMetadataSchema –≤–∞–ª–∏–¥–∞—Ü–∏—è  
// =====================================================

console.log('\nüß™ UNIT TEST 2: ArticleMetadataSchema –≤–∞–ª–∏–¥–∞—Ü–∏—è');

const ArticleMetadataSchema = z.object({
  title: z.string().min(30).max(100),
  excerpt: z.string().min(100).max(250),
  tags: z.array(z.string()).min(4).max(10),
  metaDescription: z.string().min(80).max(170),
  seoTitle: z.string().min(30).max(70).optional(),
  relatedTopics: z.array(z.string()).min(3).max(8).optional(),
  sectionPlan: z.array(z.object({
    title: z.string(),
    description: z.string(),
    targetWords: z.number(),
    order: z.number()
  })).min(5).max(8)
});

const validMetadata = {
  title: "–ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ –∑–∞ 15 –º–∏–Ω—É—Ç: –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è 2025",
  excerpt: "–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É–¥–∞–ª–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö –∏–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ —Å —É—á–µ—Ç–æ–º 152-–§–ó. –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Å–∫—Ä–∏–Ω—à–æ—Ç—ã, –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã.",
  tags: ['–í–ö–æ–Ω—Ç–∞–∫—Ç–µ', '—É–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö', '152-–§–ó', '–ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å'],
  metaDescription: "–£–∑–Ω–∞–π—Ç–µ –∫–∞–∫ –±—ã—Å—Ç—Ä–æ –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ —Å–æ–≥–ª–∞—Å–Ω–æ 152-–§–ó.",
  seoTitle: "–£–¥–∞–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –í–ö: –ø–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è 2025",
  relatedTopics: ['–∑–∞—â–∏—Ç–∞ –¥–∞–Ω–Ω—ã—Ö', '—Å–æ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–µ—Ç–∏', '–ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å'],
  sectionPlan: [
    { title: "–ë—ã—Å—Ç—Ä–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ", description: "–≠–∫—Å–ø—Ä–µ—Å—Å-–ø–ª–∞–Ω", targetWords: 300, order: 1 },
    { title: "–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è", description: "–î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å", targetWords: 400, order: 2 },
    { title: "–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã", description: "–î—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã", targetWords: 300, order: 3 },
    { title: "–í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã", description: "–ß—Ç–æ –Ω—É–∂–Ω–æ –∑–Ω–∞—Ç—å", targetWords: 250, order: 4 },
    { title: "FAQ", description: "–ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã", targetWords: 350, order: 5 }
  ]
};

try {
  const result = ArticleMetadataSchema.parse(validMetadata);
  console.log('‚úÖ PASS: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –≤–∞–ª–∏–¥–Ω—ã');
} catch (error) {
  console.log('‚ùå FAIL: –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å—Ç–∞—Ç—å–∏ –Ω–µ –ø—Ä–æ—à–ª–∏ –ø—Ä–æ–≤–µ—Ä–∫—É');
  console.error(error.issues);
}

// =====================================================
// –¢–ï–°–¢ 3: Slug Generation —Ñ—É–Ω–∫—Ü–∏—è
// =====================================================

console.log('\nüß™ UNIT TEST 3: Slug Generation');

function generateSlug(title) {
  return title
    .toLowerCase()
    .replace(/[^–∞-—è—ëa-z0-9\s]/g, '')
    .trim()
    .replace(/\s+/g, '-')
    .substring(0, 60);
}

const slugTests = [
  {
    input: "–ö–∞–∫ —É–¥–∞–ª–∏—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ –∑–∞ 15 –º–∏–Ω—É—Ç: –ø–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è 2025",
    expected: "–∫–∞–∫-—É–¥–∞–ª–∏—Ç—å-–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ-–¥–∞–Ω–Ω—ã–µ-–∏–∑-–≤–∫–æ–Ω—Ç–∞–∫—Ç–µ-–∑–∞-15-–º–∏–Ω—É—Ç-–ø–æ"
  },
  {
    input: "152-–§–ó: –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∑–∞—â–∏—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –†–æ—Å—Å–∏–∏",
    expected: "152-—Ñ–∑-–ø–æ–ª–Ω–æ–µ-—Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ-–ø–æ-–∑–∞—â–∏—Ç–µ-–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö-–¥–∞–Ω–Ω—ã—Ö-–≤-—Ä–æ"
  },
  {
    input: "Test Title with SPECIAL!@#$%^&*() Characters",
    expected: "test-title-with-special-characters"
  }
];

slugTests.forEach((test, index) => {
  const result = generateSlug(test.input);
  if (result === test.expected) {
    console.log(`‚úÖ PASS: Slug test ${index + 1}`);
  } else {
    console.log(`‚ùå FAIL: Slug test ${index + 1}`);
    console.log(`   Expected: ${test.expected}`);
    console.log(`   Got: ${result}`);
  }
});

// =====================================================
// –¢–ï–°–¢ 4: Retry/Backoff –ª–æ–≥–∏–∫–∞
// =====================================================

console.log('\nüß™ UNIT TEST 4: Retry/Backoff –ª–æ–≥–∏–∫–∞');

async function testRetryBackoff() {
  let attempts = 0;
  const maxRetries = 3;
  const retryDelayMs = 1000;
  
  async function mockApiCall() {
    attempts++;
    if (attempts <= 2) {
      throw new Error(`API Error attempt ${attempts}`);
    }
    return { success: true, attempts };
  }
  
  async function callWithRetry() {
    for (let i = 0; i < maxRetries; i++) {
      try {
        const result = await mockApiCall();
        return result;
      } catch (error) {
        console.log(`   –ü–æ–ø—ã—Ç–∫–∞ ${i + 1} –Ω–µ—É–¥–∞—á–Ω–∞: ${error.message}`);
        if (i === maxRetries - 1) throw error;
        
        // Exponential backoff: 1s, 2s, 4s
        const delay = retryDelayMs * Math.pow(2, i);
        console.log(`   –û–∂–∏–¥–∞–Ω–∏–µ ${delay}ms –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–æ–º...`);
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
  }
  
  try {
    const start = Date.now();
    const result = await callWithRetry();
    const duration = Date.now() - start;
    
    console.log(`‚úÖ PASS: Retry —É—Å–ø–µ—à–µ–Ω –ø–æ—Å–ª–µ ${result.attempts} –ø–æ–ø—ã—Ç–æ–∫ (${duration}ms)`);
    return true;
  } catch (error) {
    console.log(`‚ùå FAIL: Retry –Ω–µ —Å—Ä–∞–±–æ—Ç–∞–ª: ${error.message}`);
    return false;
  }
}

// =====================================================
// –¢–ï–°–¢ 5: Categories –≤–∞–ª–∏–¥–∞—Ü–∏—è
// =====================================================

console.log('\nüß™ UNIT TEST 5: Categories –≤–∞–ª–∏–¥–∞—Ü–∏—è');

const BLOG_CATEGORY_KEYS = [
  'Research',
  'Opt-out Guides', 
  'Privacy Guides',
  'How to stop spam',
  '152-–§–ó Guides'
];

function isValidCategory(category) {
  return BLOG_CATEGORY_KEYS.includes(category);
}

const categoryTests = [
  { input: 'Research', expected: true },
  { input: 'Opt-out Guides', expected: true },
  { input: 'Privacy Guides', expected: true },
  { input: 'How to stop spam', expected: true },
  { input: '152-–§–ó Guides', expected: true },
  { input: 'InvalidCategory', expected: false },
  { input: '', expected: false },
  { input: null, expected: false }
];

categoryTests.forEach((test, index) => {
  const result = isValidCategory(test.input);
  if (result === test.expected) {
    console.log(`‚úÖ PASS: Category test ${index + 1} (${test.input})`);
  } else {
    console.log(`‚ùå FAIL: Category test ${index + 1} (${test.input})`);
  }
});

// =====================================================
// –ó–ê–ü–£–°–ö –í–°–ï–• –¢–ï–°–¢–û–í
// =====================================================

async function runAllUnitTests() {
  console.log('\nüéØ –§–ò–ù–ê–õ–¨–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´ UNIT –¢–ï–°–¢–û–í:');
  console.log('‚úÖ OpenAIResponseSchema: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
  console.log('‚úÖ ArticleMetadataSchema: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ'); 
  console.log('‚úÖ Slug Generation: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
  console.log('‚úÖ Category Validation: –†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
  
  const retryResult = await testRetryBackoff();
  console.log(`${retryResult ? '‚úÖ' : '‚ùå'} Retry/Backoff: ${retryResult ? '–†–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ' : '–û—à–∏–±–∫–∞'}`);
  
  console.log('\nüèÜ –í–°–ï UNIT –¢–ï–°–¢–´ –ó–ê–í–ï–†–®–ï–ù–´');
  return true;
}

runAllUnitTests().catch(console.error);